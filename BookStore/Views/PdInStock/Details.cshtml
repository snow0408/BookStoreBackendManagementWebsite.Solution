@model ProductDetailsVm
@using BookStore.Models.ViewModels
<style>


    /* 图片容器样式 */
    .image-container {
        position: relative;
        width: 150;
        padding-top: 100%; /* 1:1 高度，保证正方形 */
        overflow: hidden;
    }

        /* 图片样式 */
        .image-container img {
            position: absolute;
            top: 0;
            left: 0;
            width: 160%;
            height: auto;
            justify-content: center;
            display: flex;
        }
</style>


@{
    ViewBag.Title = "產品詳情";
}
<p>

    @Html.ActionLink("返回上一頁", "Index", "Products", new { area = "" }, new { @class = "btn btn-light" })
</p>
<div class="container mt-4">
    <div class="row">
        <div class="col-sm-12">
            <div class="card">
                <div class="card-body">
                    <div class="tab-content" id="top-tabContent">
                        <div class="row">
                            <!-- 左側圖片容器 -->
                            <div class="col-md-6">
                                <div class="image-container">
                                    <img src="https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?q=80&amp;w=1974&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                                         alt="圖片描述" />
                                </div>
                            </div>
                            <!-- 右側信息 -->
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-9">
                                        <h2>@Model.Name</h2>
                                    </div>
                                    <div class="col-3 text-end">
                                        <span class="badge badge-primary">@Model.Status</span>
                                    </div>
                                </div>
                                <hr />
                                <!-- 信息列 -->
                                <div class="row details">
                                    <div class="col-3">
                                        <span><i class="fas fa-ghost" style="color: #b197fc">&nbsp;</i>產品編號</span>
                                    </div>
                                    <div class="col-9 text-primary">@Model.ProductId</div>

                                    <div class="col-3">
                                        <span><i class="fas fa-tag" style="color: #b197fc">&nbsp;</i>商品分類</span>
                                    </div>
                                    <div class="col-9 text-primary">@Model.Category</div>

                                    <div class="col-3">
                                        <span><i class="fa-solid fa-money-bill" style="color: #b197fc">&nbsp;</i>目前定價</span>
                                    </div>
                                    <div class="col-9 text-primary">@Model.Price</div>
                                </div>
                                <hr />
                                <!-- 項目狀態 -->
                                <div class="project-status mt-4">
                                    <div class="media mb-0">
                                        <i class="fas fa-layer-group" style="color: #B197FC;"></i>&nbsp;<span>目前庫存</span>
                                        <p>@Model.Stock 個</p>
                                    </div>
                                    <div class="progress" style="height: 5px">
                                        <div class="progress-bar-animated bg-primary progress-bar-striped" role="progressbar" style="width: @Model.Stock%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>


                                <!-- 渲染進貨表單 -->
                                @Html.Partial("_StockInForm", Model)


                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 渲染歷史紀錄 -->
<div id="pdInStockRecords">
    @Html.Partial("_PdInStockRecordsPartial", Model.PdInStockRecords)
</div>

@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            // 使用事件委托，绑定到静态父元素上
            $(document).on('click', '.increment-touchspin', function () {
                var $qtyInput = $(this).closest('.input-group').find('.input-touchspin');
                var currentVal = parseInt($qtyInput.val(), 10);
                $qtyInput.val(currentVal + 1);
            });

            $(document).on('click', '.decrement-touchspin', function () {
                var $qtyInput = $(this).closest('.input-group').find('.input-touchspin');
                var currentVal = parseInt($qtyInput.val(), 10);
                $qtyInput.val(Math.max(currentVal - 1, 1)); // 防止数量小于1
            });

            // 進貨表單提交事件處理
            //$('#stockInForm').submit(function (event) {
            //    event.preventDefault(); // 防止表單默認提交
            //    var formData = $(this).serialize(); // 序列化表單數據

            //    $.ajax({
            //        type: "POST",
            //        url: $(this).attr('action'),
            //        data: formData,
            //        success: function (response) {
            //            updatePdInStockRecords();
            //        },
            //        error: function () {
            //            alert("進貨操作失敗");
            //        }
            //    });
            //});

            @*function updatePdInStockRecords() {
                $.ajax({
                    url: '@Url.Action("GetPdInStockRecordsPartial", "PdInStock", new { productId = Model.ProductId })',
                    success: function (data) {
                        $('#pdInStockRecords').html(data);
                        // 清空輸入欄位
                        $('#datetime-local').val('');
                        $('#BuyPrice').val('');
                        $('#Qty').val('1'); // 或者設置為您想要的默認值
                    },
                    error: function () {
                        alert("進貨記錄更新失敗");
                    }
                });
            }
        });*@
    </script>
}